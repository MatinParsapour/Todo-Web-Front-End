<div class="buttons">
  <button class="arrowBackButton" (click)="backToMain()" mat-icon-button>
    <span class="material-icons">
      arrow_back
    </span>
  </button>
  <button (click)="openNewTopicDialog()" mat-icon-button matTooltip="new topic">
    <mat-icon>add</mat-icon>
  </button>
</div>
<mat-spinner *ngIf="isLoading"></mat-spinner>
<div class="dataContainer">
  <div>
    <div (contextmenu)="preventDefault($event)" class="topicContainer scrollbar-table" id="style-red">
      <div *ngIf="requests.length === 0">
        You have no request
      </div>
      <div *ngFor="let request of requests" (click)="getRequestData(request.id)">
        <div>
          <span class="colorAndFontSizeForHeaders">Topic</span>
          {{request.topic}}
        </div>
        <div>
          <span class="colorAndFontSizeForHeaders">Started at</span>
          {{request.startsAt | date : 'short'}}
        </div>
        <button id="iconButton" mat-icon-button #triggerBtn [matMenuTriggerFor]="normalMenu">
          <mat-icon>more_vert</mat-icon>
        </button>
        <mat-menu class="menu" #normalMenu="matMenu">
          <button mat-menu-item class="material-icons delete" (click)="deleteRequest(request.id)"
            matTooltip="delete list">
            <mat-icon>delete</mat-icon> Delete Request
          </button>
        </mat-menu>
      </div>
    </div>
  </div>
  <div class="requests">
    <div class="requestData" *ngIf="request">
      <div class="requestIsDone" *ngIf="request.isSolved || request.isFinished">
        <div *ngIf="request.isSolved">
          <span>this request is solved</span>
        </div>
        <div *ngIf="request.isFinished">
          <span>this request is finished</span>
        </div>
      </div>
      <div class="request">
        <div class="requestHeader">
          <div>
            <span class="colorAndFontSizeForHeaders">Topic</span>
            <p>{{request.topic}}</p>
          </div>
          <div>
            <span class="colorAndFontSizeForHeaders">Started at</span>
            <p>{{request.startsAt | date: 'short'}}</p>
          </div>
          <div>
            <span class="colorAndFontSizeForHeaders">Solved</span>
            <p>{{request.isSolved ? 'Yes' : 'No'}}</p>
          </div>
          <div>
            <span class="colorAndFontSizeForHeaders">Finished</span>
            <p>{{request.isFinished ? 'Yes' : 'No'}}</p>
          </div>
          <div>
            <span class="colorAndFontSizeForHeaders">Priority</span>
            <p>{{request.priority}}</p>
          </div>
        </div>
      </div>
      <div #scroller (contextmenu)="preventDefault($event)" class="messagesContainer scrollbar-table" id="style-red">
        <div (contextmenu)="openMenu($event, message)" class="message" *ngFor="let message of request.messages">
          <div>
            <p class="colorAndFontSizeForHeaders"> {{message.user.firstName}} {{message.user.lastName}} </p>
            <p class="messageData"> {{message.message}} </p>
            <p class="messageDate colorAndFontSizeForHeaders"> {{message.sentAt | date : 'shortTime'}} </p>
          </div>
          <div [class.alighItemsFlexEnd]="!isSender(message.user.id)" *ngIf="!isSender(message.user.id)">
            <p> {{message.message}} </p>
          </div>
        </div>
      </div>
      <div class="input">
        <textarea (keydown.enter)="sendMessage(); preventDefault($event)" [formControl]="messaged" matInput
          color="primary"></textarea>
        <img (click)="requestSolved()" [matTooltip]="request.isSolved ? 'Unsolve' : 'Solve'" class="solvedButton" src="https://img.icons8.com/fluency/48/000000/solve.png" />
        <button mat-icon-button (click)="requestFinished()" class="doneButton">
          <mat-icon>done</mat-icon>
        </button>
      </div>
    </div>
  </div>
</div>

<div (contextmenu)="preventDefault($event)" style="visibility: hidden; position: fixed;"
  [style.left]="menuTopLeftPosition.x" [style.top]="menuTopLeftPosition.y" [matMenuTriggerFor]="rightMenu"></div>

=<mat-menu #rightMenu="matMenu">
  <ng-template matMenuContent let-item="item">
    <button class="menuButton edit" (click)="editMessage(item.id)" mat-menu-item>Edit <mat-icon>edit</mat-icon></button>
    <button class="menuButton delete" (click)="deleteMessage(item.id)" mat-menu-item>Delete <mat-icon>delete</mat-icon>
    </button>
  </ng-template>
</mat-menu>
